<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>BI - Business Intelligence Platform</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        'primary-brand': '#007bff',
                        'primary-brand-hover': '#0056b3',
                        'background-light': '#F8F9FA',
                        'surface-light': '#FFFFFF',
                        'text-default': '#343A40',
                        'text-muted': '#6C757D',
                        'border-light': '#E9ECEF',
                        'sidebar-bg-light': '#FFFFFF',
                        'sidebar-active-light': '#E0EEFF',
                        'log-timestamp': '#99A0A7',
                        'log-info': '#17A2B8',
                        'log-warn': '#FFC107',
                        'log-error': '#DC3545',
                        'log-debug': '#6F42C1',
                        'status-success': '#28A745',
                        'status-failed': '#DC3545',
                        'status-degraded': '#FFC107',
                    },
                    fontFamily: {
                        sans: ["Inter", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.375rem",
                        sm: "0.25rem",
                        md: "0.5rem",
                        lg: "0.75rem",
                        xl: "1rem",
                    },
                    boxShadow: {
                        DEFAULT: '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        md: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        lg: '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    },
                },
            },
        };
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: 'Inter', sans-serif;
            @apply text-text-default;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F1F1F1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #CED4DA;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ADB5BD;
        }
        .form-input, .form-textarea, .form-select {
            @apply border border-border-light bg-surface-light text-text-default focus:ring-primary-brand focus:border-primary-brand px-2.5 py-1.5 text-xs rounded-md shadow-sm;
        }
        .form-input::placeholder {
            @apply text-text-muted;
        }
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
        .hidden {
            display: none;
        }
        .log-line {
            @apply flex text-xs;
        }
        .log-timestamp {
            @apply text-log-timestamp mr-3 flex-shrink-0;
        }
        .log-level-INFO {
            @apply text-log-info;
        }
        .log-level-WARN {
            @apply text-log-warn;
        }
        .log-level-ERROR {
            @apply text-log-error;
        }
        .log-level-DEBUG {
            @apply text-log-debug;
        }
        .toolbar-btn {
            @apply transition-colors;
        }
        .toolbar-btn.active {
            @apply bg-gray-200;
        }
        .toolbox-btn {
            @apply transition-colors cursor-pointer;
        }
        .toolbox-btn:hover {
            @apply bg-gray-100;
        }
        .toolbox-btn select {
            @apply bg-transparent border-none outline-none cursor-pointer;
        }
        /* Dataset Preview */
        .dataset-item {
            transition: all 0.2s;
            position: relative;
        }
        .dataset-item:hover {
            transform: translateX(2px);
        }
        .dataset-preview {
            pointer-events: auto;
        }
        .dataset-preview table {
            border-collapse: collapse;
            width: 100%;
        }
        .dataset-preview tbody tr:hover {
            background-color: #eff6ff;
        }
        #designCanvas:focus {
            outline: none;
        }
        #designCanvas img {
            max-width: 100%;
            height: auto;
        }
        #designCanvas table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }
        #designCanvas table td,
        #designCanvas table th {
            border: 1px solid #ddd;
            padding: 8px;
            min-width: 50px;
        }
        #designCanvas table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .chart-widget {
            transition: all 0.2s;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .chart-widget:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .chart-widget.dragging {
            cursor: move !important;
            opacity: 0.8;
        }
        .chart-widget.has-drill-through {
            border-left: 4px solid #007bff;
        }
        .chart-widget.drill-through-target {
            border-right: 4px solid #28a745;
        }
        .chart-widget.filtered {
            opacity: 0.7;
            position: relative;
        }
        .chart-widget.filtered::after {
            content: 'Filtered';
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,123,255,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            z-index: 10;
        }
        .slicer-btn {
            transition: all 0.2s;
        }
        .card-widget {
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .special-char-btn {
            min-height: 80px;
        }
        .special-char-btn:hover {
            transform: scale(1.05);
        }
        .shape-btn:hover {
            transform: scale(1.05);
        }
        .shape-container {
            cursor: move;
        }
        .shape-wrapper svg {
            display: block;
        }
        .tab-btn {
            transition: all 0.2s;
        }
        .image-widget img {
            transition: all 0.3s;
        }
        .image-widget img:hover {
            opacity: 0.8;
        }
        .text-box-content {
            -webkit-user-modify: read-write-plaintext-only;
            -moz-user-modify: read-write-plaintext-only;
        }
        .text-box-content[contenteditable="true"] {
            -webkit-user-modify: read-write-plaintext-only;
            -moz-user-modify: read-write-plaintext-only;
        }
        /* Custom Tooltip */
        .custom-tooltip {
            position: absolute;
            background-color: #1F2937;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.2s, transform 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .custom-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }
        .custom-tooltip::after {
            content: '';
            position: absolute;
            border: 5px solid transparent;
        }
        /* Sidebar tooltip - sağda görünür */
        .sidebar-tooltip {
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%) translateX(-5px);
        }
        .sidebar-tooltip.show {
            transform: translateY(-50%) translateX(0);
        }
        .sidebar-tooltip::after {
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-right-color: #1F2937;
        }
        /* Toolbox tooltip - solda görünür */
        .toolbox-tooltip {
            right: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%) translateX(5px);
        }
        .toolbox-tooltip.show {
            transform: translateY(-50%) translateX(0);
        }
        .toolbox-tooltip::after {
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-left-color: #1F2937;
        }
        /* Page drag and drop styles */
        .page-item {
            transition: all 0.2s;
        }
        .page-item.dragging {
            opacity: 0.5;
            cursor: move;
        }
        .page-item[draggable="true"] {
            cursor: move;
        }
        .drag-handle {
            cursor: grab;
            user-select: none;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        .page-item:hover .drag-handle {
            color: #007bff;
        }
        /* Toolbar Symbols & Shapes Panel Scrollbar */
        .symbols-shapes-toolbar-panel::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .symbols-shapes-toolbar-panel::-webkit-scrollbar-track {
            background: #F1F1F1;
            border-radius: 3px;
        }
        .symbols-shapes-toolbar-panel::-webkit-scrollbar-thumb {
            background: #CED4DA;
            border-radius: 3px;
        }
        .symbols-shapes-toolbar-panel::-webkit-scrollbar-thumb:hover {
            background: #ADB5BD;
        }
        .toolbar-symbol-shape-btn {
            transition: all 0.2s;
        }
        .toolbar-symbol-shape-btn:hover {
            transform: scale(1.1);
            z-index: 10;
        }
    </style>
</head>
<body class="bg-background-light text-text-default antialiased h-screen overflow-hidden flex transition-colors duration-300">
    <!-- Sidebar -->
    <aside id="sidebarPanel" class="w-20 bg-sidebar-bg-light flex flex-col border-r border-border-light z-20 flex-shrink-0 shadow-sm transition-all duration-300">
        <div class="h-16 flex items-center justify-between px-3 border-b border-border-light">
            <div class="flex items-center gap-2 flex-1">
                <span class="material-symbols-outlined text-primary-brand text-2xl">analytics</span>
                <span id="sidebarLogo" class="text-primary-brand font-bold text-lg tracking-tight hidden">BI</span>
            </div>
            <button id="sidebarToggle" onclick="toggleSidebar()" class="p-1 hover:bg-gray-100 rounded transition-colors" title="Genişlet">
                <span class="material-symbols-outlined text-base text-text-muted">chevron_right</span>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto py-3">
            <nav class="space-y-1 px-2">
                <a class="menu-link flex items-center gap-3 px-3 py-2.5 bg-sidebar-active-light border-l-4 border-primary-brand text-primary-brand font-medium group transition-colors rounded-md" data-section="dashboard" href="#" title="Dashboard">
                    <span class="material-symbols-outlined text-2xl flex-shrink-0">dashboard</span>
                    <span class="menu-text text-sm hidden whitespace-nowrap">Dashboard</span>
                </a>
                <div class="menu-group">
                    <a class="menu-link flex items-center gap-3 px-3 py-2.5 text-text-default hover:bg-gray-100 hover:text-primary-brand border-l-4 border-transparent transition-colors rounded-md" id="analyzeMenuToggle" href="#" onclick="toggleSubmenu(event)" title="Analyze Your Data">
                        <span class="material-symbols-outlined text-2xl flex-shrink-0">analytics</span>
                        <span class="menu-text text-sm hidden whitespace-nowrap flex-1">Analyze Your Data</span>
                        <span class="material-symbols-outlined text-sm submenu-chevron hidden flex-shrink-0">chevron_right</span>
                    </a>
                    <div class="submenu hidden pl-2" id="analyzeSubmenu">
                        <a class="submenu-link flex items-center gap-3 px-3 py-2 text-text-default hover:bg-gray-100 hover:text-primary-brand border-l-4 border-transparent transition-colors text-xs rounded-md" data-section="design-empty" href="#" title="Empty Canvas">
                            <span class="material-symbols-outlined text-2xl flex-shrink-0">edit</span>
                            <span class="menu-text hidden whitespace-nowrap">Empty Canvas</span>
                        </a>
                        <a class="submenu-link flex items-center gap-3 px-3 py-2 text-text-default hover:bg-gray-100 hover:text-primary-brand border-l-4 border-transparent transition-colors text-xs rounded-md" data-section="design-saved" href="#" title="Saved Canvas">
                            <span class="material-symbols-outlined text-2xl flex-shrink-0">folder</span>
                            <span class="menu-text hidden whitespace-nowrap">Saved Canvas</span>
                        </a>
                    </div>
                </div>
                <a class="menu-link flex items-center gap-3 px-3 py-2.5 text-text-default hover:bg-gray-100 hover:text-primary-brand border-l-4 border-transparent transition-colors rounded-md" data-section="data-stream" href="#" title="Data Stream">
                    <span class="material-symbols-outlined text-2xl flex-shrink-0">stream</span>
                    <span class="menu-text text-sm hidden whitespace-nowrap">Data Stream</span>
                </a>
                <a class="menu-link flex items-center gap-3 px-3 py-2.5 text-text-default hover:bg-gray-100 hover:text-primary-brand border-l-4 border-transparent transition-colors rounded-md" data-section="data-sources" href="#" title="Financial Statement">
                    <span class="material-symbols-outlined text-2xl flex-shrink-0">receipt_long</span>
                    <span class="menu-text text-sm hidden whitespace-nowrap">Financial Statement</span>
                </a>
                <a class="menu-link flex items-center gap-3 px-3 py-2.5 text-text-default hover:bg-gray-100 hover:text-primary-brand border-l-4 border-transparent transition-colors rounded-md" data-section="settings" href="#" title="Settings">
                    <span class="material-symbols-outlined text-2xl flex-shrink-0">settings</span>
                    <span class="menu-text text-sm hidden whitespace-nowrap">Settings</span>
                </a>
                <a class="menu-link flex items-center gap-3 px-3 py-2.5 text-text-default hover:bg-gray-100 hover:text-primary-brand border-l-4 border-transparent transition-colors rounded-md" data-section="linked-services" href="#" title="Linked Services">
                    <span class="material-symbols-outlined text-2xl flex-shrink-0">link</span>
                    <span class="menu-text text-sm hidden whitespace-nowrap">Linked Services</span>
                </a>
            </nav>
        </div>
        <div class="p-3 border-t border-border-light">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-blue-100 text-primary-brand flex items-center justify-center text-xs font-bold uppercase flex-shrink-0" title="John Doe - ADMIN">
                    JD
                </div>
                <div id="sidebarUserInfo" class="flex-1 min-w-0 hidden">
                    <p class="text-sm font-medium text-text-default truncate">John Doe</p>
                    <p class="text-xs text-text-muted truncate">ADMIN</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        <!-- Header -->
        <header class="bg-surface-light border-b border-border-light z-10 px-6 py-4 flex justify-between items-center shadow-sm transition-colors duration-300">
            <div class="flex items-center gap-3">
                <div class="flex flex-col">
                    <h1 class="text-xl font-semibold text-text-default tracking-tight" id="headerTitle">LINKED_SERVICES</h1>
                    <p class="text-xs text-text-muted mt-0.5" id="headerSubtitle">System overview for linked service health and configuration.</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button id="addServiceBtn" class="bg-primary-brand hover:bg-primary-brand-hover text-white px-4 py-2.5 rounded-lg flex items-center gap-2 font-medium text-sm transition-all shadow-md hover:shadow-lg">
                    <span class="material-symbols-outlined text-lg">add</span>
                    <span>ADD SERVICE</span>
                </button>
            </div>
        </header>

        <!-- Content Area -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Linked Services Section -->
            <div id="linked-services-section" class="flex-1 flex overflow-hidden">
            <!-- Left Panel - Services List -->
            <div class="w-1/3 flex flex-col border-r border-border-light bg-surface-light overflow-hidden">
                <!-- Search Bar -->
                <div class="p-4 border-b border-border-light flex items-center bg-background-light">
                    <div class="relative flex-1 mr-4">
                        <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted text-lg">search</span>
                        <input id="searchInput" class="pl-10 pr-4 py-2 text-sm border-border-light bg-surface-light text-text-default placeholder-text-muted w-full rounded-md focus:ring-primary-brand focus:border-primary-brand shadow-sm" placeholder="Search services..." type="text"/>
                    </div>
                    <button id="refreshBtn" class="p-2 border border-border-light text-text-muted hover:text-primary-brand hover:bg-gray-100 rounded-md shadow-sm">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                </div>

                <!-- Services List -->
                <div id="servicesList" class="flex-1 overflow-y-auto text-sm divide-y divide-border-light">
                    <!-- Services will be rendered here -->
                </div>

                <!-- Pagination -->
                <div class="px-4 py-2 bg-background-light flex items-center justify-between text-text-muted text-xs border-t border-border-light">
                    <div>
                        Showing <span class="font-medium text-text-default" id="showingFrom">1</span> to <span class="font-medium text-text-default" id="showingTo">5</span> of <span class="font-medium text-text-default" id="totalServices">0</span> results
                    </div>
                    <div class="flex gap-2">
                        <button id="prevBtn" class="px-2 py-0.5 border border-border-light rounded-md text-xs text-text-muted hover:bg-gray-100 hover:text-primary-brand disabled:opacity-50 disabled:hover:bg-transparent shadow-sm">PREV</button>
                        <button id="nextBtn" class="px-2 py-0.5 border border-border-light rounded-md text-xs text-text-muted hover:bg-gray-100 hover:text-primary-brand shadow-sm">NEXT</button>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Service Details -->
            <div id="detailsPanel" class="flex-1 flex flex-col bg-background-light overflow-hidden hidden">
                <!-- Details Header -->
                <div class="p-4 border-b border-border-light bg-surface-light flex items-center justify-between shadow-sm">
                    <h2 id="detailsTitle" class="text-xl font-bold text-text-default">SERVICE_DETAILS</h2>
                    <div class="flex gap-2">
                        <button id="editBtn" class="p-2 border border-border-light text-text-muted hover:text-primary-brand hover:bg-gray-100 rounded-md shadow-sm">
                            <span class="material-symbols-outlined">edit</span>
                        </button>
                        <button id="testConnectionBtn" class="p-2 border border-border-light text-text-muted hover:text-primary-brand hover:bg-gray-100 rounded-md shadow-sm">
                            <span class="material-symbols-outlined">play_arrow</span>
                        </button>
                        <button id="deleteServiceBtn" class="p-2 border border-border-light text-text-muted hover:text-primary-brand hover:bg-gray-100 rounded-md shadow-sm">
                            <span class="material-symbols-outlined">delete</span>
                        </button>
                    </div>
                </div>

                <!-- Details Content -->
                <div class="flex-1 overflow-y-auto p-4 space-y-4">
                    <!-- Configuration Details -->
                    <section id="configSection" class="bg-surface-light p-4 rounded-lg shadow-md">
                        <h3 class="text-base font-semibold text-text-default mb-3 border-b border-border-light pb-2">Configuration Details</h3>
                        <form id="serviceForm" class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                            <div>
                                <div class="text-text-muted mb-1 text-xs">Service Type:</div>
                                <select id="serviceType" class="form-select w-full" required>
                                    <option value="db">DB</option>
                                    <option value="ai">AI API</option>
                                    <option value="file">File</option>
                                </select>
                            </div>
                            <div>
                                <div class="text-text-muted mb-1 text-xs">Service Name:</div>
                                <input type="text" id="serviceName" class="form-input w-full" required>
                            </div>
                            <div class="md:col-span-2">
                                <div class="text-text-muted mb-1 text-xs">Description:</div>
                                <textarea id="description" class="form-textarea w-full" rows="1.5"></textarea>
                            </div>

                            <!-- DB Fields -->
                            <div id="dbFields">
                                <div>
                                    <div class="text-text-muted mb-1 text-xs">Server Name:</div>
                                    <input type="text" id="serverName" class="form-input w-full" placeholder="e.g., localhost, server.database.windows.net">
                                </div>
                                <div>
                                    <div class="text-text-muted mb-1 text-xs">Database Name:</div>
                                    <input type="text" id="databaseName" class="form-input w-full">
                                </div>
                                <div>
                                    <div class="text-text-muted mb-1 text-xs">Authentication Type:</div>
                                    <select id="authType" class="form-select w-full">
                                        <option value="windows">Windows Authentication</option>
                                        <option value="sql">SQL Server Authentication</option>
                                    </select>
                                </div>
                                <div id="sqlAuthFields" class="hidden">
                                    <div>
                                        <div class="text-text-muted mb-1 text-xs">Username:</div>
                                        <input type="text" id="username" class="form-input w-full">
                                    </div>
                                    <div>
                                        <div class="text-text-muted mb-1 text-xs">Password:</div>
                                        <input type="password" id="password" class="form-input w-full">
                                    </div>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" id="trustCertificate" checked class="rounded border-border-light">
                                        <span class="text-text-default">Trust Server Certificate</span>
                                    </label>
                                </div>
                            </div>

                            <!-- AI Fields -->
                            <div id="aiFields" class="hidden md:col-span-2">
                                <div>
                                    <div class="text-text-muted mb-1 text-xs">AI API Key:</div>
                                    <input type="password" id="aiApiKey" class="form-input w-full" placeholder="Enter your AI API key">
                                </div>
                            </div>

                            <!-- File Fields -->
                            <div id="fileFields" class="hidden md:col-span-2">
                                <div class="space-y-3">
                                    <!-- File Upload -->
                                    <div>
                                        <div class="text-text-muted mb-1 text-xs">File Upload:</div>
                                        <input type="file" id="fileUpload" accept=".csv,.xlsx,.xls,.json,.xml" class="form-input w-full" onchange="handleFileServiceUpload(this)">
                                        <p class="text-xs text-text-muted mt-1">Supported formats: CSV, Excel (.xlsx, .xls), JSON, XML</p>
                                    </div>
                                    
                                    <!-- File Type -->
                                    <div>
                                        <div class="text-text-muted mb-1 text-xs">File Type:</div>
                                        <select id="fileType" class="form-select w-full" onchange="onFileTypeChange()">
                                            <option value="csv">CSV</option>
                                            <option value="excel">Excel</option>
                                            <option value="json">JSON</option>
                                            <option value="xml">XML</option>
                                        </select>
                                    </div>

                                    <!-- CSV/Excel Specific Settings -->
                                    <div id="csvExcelSettings" class="space-y-3 border-t border-border-light pt-3">
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Column Delimiter:</div>
                                            <select id="columnDelimiter" class="form-select w-full">
                                                <option value=",">Comma (,)</option>
                                                <option value=";">Semicolon (;)</option>
                                                <option value="\t">Tab</option>
                                                <option value="|">Pipe (|)</option>
                                                <option value="custom">Custom</option>
                                            </select>
                                        </div>
                                        <div id="customDelimiterField" class="hidden">
                                            <div class="text-text-muted mb-1 text-xs">Custom Delimiter:</div>
                                            <input type="text" id="customDelimiter" class="form-input w-full" maxlength="1" placeholder="Enter custom delimiter">
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Row Delimiter:</div>
                                            <select id="rowDelimiter" class="form-select w-full">
                                                <option value="\r\n">CRLF (\r\n)</option>
                                                <option value="\n">LF (\n)</option>
                                                <option value="\r">CR (\r)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Text Qualifier:</div>
                                            <select id="textQualifier" class="form-select w-full">
                                                <option value='\"'>Double Quote (")</option>
                                                <option value="'">Single Quote (')</option>
                                                <option value="">None</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" id="firstRowAsHeader" checked class="rounded border-border-light">
                                                <span class="text-text-default text-xs">First Row as Header</span>
                                            </label>
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Encoding:</div>
                                            <select id="fileEncoding" class="form-select w-full">
                                                <option value="UTF-8">UTF-8</option>
                                                <option value="UTF-16">UTF-16</option>
                                                <option value="ISO-8859-1">ISO-8859-1 (Latin-1)</option>
                                                <option value="Windows-1252">Windows-1252</option>
                                                <option value="ASCII">ASCII</option>
                                            </select>
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Escape Character:</div>
                                            <select id="escapeCharacter" class="form-select w-full">
                                                <option value="\\">Backslash (\)</option>
                                                <option value="">None</option>
                                            </select>
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Null Value:</div>
                                            <input type="text" id="nullValue" class="form-input w-full" placeholder="e.g., NULL, empty" value="">
                                        </div>
                                    </div>

                                    <!-- JSON Specific Settings -->
                                    <div id="jsonSettings" class="hidden space-y-3 border-t border-border-light pt-3">
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">JSON Format:</div>
                                            <select id="jsonFormat" class="form-select w-full">
                                                <option value="array">Array of Objects</option>
                                                <option value="object">Single Object</option>
                                                <option value="lines">JSON Lines (one JSON per line)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Encoding:</div>
                                            <select id="jsonEncoding" class="form-select w-full">
                                                <option value="UTF-8">UTF-8</option>
                                                <option value="UTF-16">UTF-16</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- XML Specific Settings -->
                                    <div id="xmlSettings" class="hidden space-y-3 border-t border-border-light pt-3">
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">XML Format:</div>
                                            <select id="xmlFormat" class="form-select w-full">
                                                <option value="element">Element-centric</option>
                                                <option value="attribute">Attribute-centric</option>
                                            </select>
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Root Element Name:</div>
                                            <input type="text" id="xmlRootElement" class="form-input w-full" placeholder="e.g., root, data">
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Row Element Name:</div>
                                            <input type="text" id="xmlRowElement" class="form-input w-full" placeholder="e.g., row, item">
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Encoding:</div>
                                            <select id="xmlEncoding" class="form-select w-full">
                                                <option value="UTF-8">UTF-8</option>
                                                <option value="UTF-16">UTF-16</option>
                                                <option value="ISO-8859-1">ISO-8859-1</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Excel Specific Settings -->
                                    <div id="excelSettings" class="hidden space-y-3 border-t border-border-light pt-3">
                                        <div>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" id="excelFirstRowAsHeader" checked class="rounded border-border-light">
                                                <span class="text-text-default text-xs">First Row as Header</span>
                                            </label>
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Sheet Name:</div>
                                            <input type="text" id="excelSheetName" class="form-input w-full" placeholder="Leave empty for first sheet">
                                        </div>
                                        <div>
                                            <div class="text-text-muted mb-1 text-xs">Range:</div>
                                            <input type="text" id="excelRange" class="form-input w-full" placeholder="e.g., A1:Z100 (optional)">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="md:col-span-2 flex gap-2 pt-3 border-t border-border-light">
                                <button type="button" id="saveBtn" class="bg-primary-brand hover:bg-primary-brand-hover text-white px-3 py-1.5 rounded-md text-xs font-medium shadow-sm">Save</button>
                                <button type="button" id="testBtn" class="bg-status-success hover:bg-green-600 text-white px-3 py-1.5 rounded-md text-xs font-medium shadow-sm">Test Connection</button>
                                <button type="button" id="cancelBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded-md text-xs font-medium shadow-sm">Cancel</button>
                            </div>
                        </form>
                    </section>

                    <!-- Event Log -->
                    <section id="eventLogSection" class="bg-surface-light p-4 rounded-lg shadow-md">
                        <h3 class="text-base font-semibold text-text-default mb-3 border-b border-border-light pb-2">Event Log</h3>
                        <div id="eventLogContainer" class="bg-background-light p-3 border border-border-light h-48 overflow-y-auto rounded-md font-mono text-xs">
                            <div id="eventLogContent">
                                <!-- Event logs will be rendered here -->
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            </div>

            <!-- Empty Canvas Section -->
            <div id="design-empty-section" class="flex-1 flex overflow-hidden hidden">
                <!-- Left Panel Container -->
                <div class="w-48 bg-surface-light border-r border-border-light flex-shrink-0 flex flex-col" style="overflow: visible;">
                    <!-- Pages Panel (Top - Smaller) -->
                    <div id="pagesPanel" class="overflow-y-auto flex flex-col" style="height: 35%; min-height: 150px;">
                        <div class="p-3 border-b border-border-light">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-sm font-semibold text-text-default">Pages</h3>
                                <button onclick="addNewPage()" class="p-1 hover:bg-gray-100 rounded transition-colors" title="Add Page">
                                    <span class="material-symbols-outlined text-lg text-text-muted">add</span>
                                </button>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto p-2">
                            <div id="pagesList" class="space-y-1">
                                <!-- Pages will be added here by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dataset Panel (Bottom - Larger, closer to Pages) -->
                    <div id="datasetPanel" class="flex-1 overflow-visible flex flex-col border-t border-border-light" style="height: 65%; min-height: 300px;">
                        <div class="p-3 border-b border-border-light">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-sm font-semibold text-text-default">Dataset</h3>
                                <button onclick="openDatasetModal()" class="p-1 hover:bg-gray-100 rounded transition-colors" title="Add Dataset">
                                    <span class="material-symbols-outlined text-lg text-text-muted">add</span>
                                </button>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto overflow-x-visible p-2" style="overflow-x: visible;">
                            <div id="datasetList" class="space-y-2 relative">
                                <!-- Datasets will be added here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Canvas Area (Right) -->
                <div class="flex-1 flex flex-col overflow-hidden bg-background-light relative">
                    <!-- Word-like Toolbar -->
                    <div class="bg-surface-light border-b border-border-light p-2">
                        <div class="flex flex-wrap items-center gap-2">
                            <!-- Left Side - Font Controls & Formatting -->
                            <div class="flex items-center gap-1 flex-1">
                                <!-- Font Family -->
                                <select id="toolbarFont" class="toolbox-btn px-2 py-2 border border-border-light rounded-md text-sm text-text-default hover:bg-gray-100 transition-colors" onchange="applyFormat('fontName', this.value)">
                                    <option value="Arial">Arial</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                    <option value="Courier New">Courier New</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Verdana">Verdana</option>
                                    <option value="Comic Sans MS">Comic Sans MS</option>
                                </select>
                                
                                <!-- Font Size -->
                                <select id="toolbarFontSize" class="toolbox-btn px-2 py-2 border border-border-light rounded-md text-sm text-text-default hover:bg-gray-100 transition-colors" onchange="applyFormat('fontSize', this.value)">
                                    <option value="1">8pt</option>
                                    <option value="2">10pt</option>
                                    <option value="3" selected>12pt</option>
                                    <option value="4">14pt</option>
                                    <option value="5">18pt</option>
                                    <option value="6">24pt</option>
                                    <option value="7">36pt</option>
                                </select>
                                
                                <!-- Text Formatting -->
                                <div class="flex gap-1 border-l border-border-light pl-2">
                                    <button onclick="applyFormat('bold')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Bold (Ctrl+B)">
                                        <span class="material-symbols-outlined text-lg">format_bold</span>
                                    </button>
                                    <button onclick="applyFormat('italic')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Italic (Ctrl+I)">
                                        <span class="material-symbols-outlined text-lg">format_italic</span>
                                    </button>
                                    <button onclick="applyFormat('underline')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Underline (Ctrl+U)">
                                        <span class="material-symbols-outlined text-lg">format_underlined</span>
                                    </button>
                                    <button onclick="applyFormat('strikethrough')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Strikethrough">
                                        <span class="material-symbols-outlined text-lg">strikethrough_s</span>
                                    </button>
                                </div>
                                
                                <!-- Text Color -->
                                <div class="flex gap-1 border-l border-border-light pl-2">
                                    <input type="color" id="toolbarTextColor" value="#000000" class="w-9 h-9 border border-border-light rounded-md cursor-pointer transition-colors hover:bg-gray-100" onchange="applyFormat('foreColor', this.value)" title="Text Color">
                                    <button onclick="document.getElementById('toolbarTextColor').click()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Text Color">
                                        <span class="material-symbols-outlined text-lg">format_color_text</span>
                                    </button>
                                </div>
                                
                                <!-- Background Color -->
                                <div class="flex gap-1 border-l border-border-light pl-2">
                                    <input type="color" id="toolbarBgColor" value="#ffffff" class="w-9 h-9 border border-border-light rounded-md cursor-pointer transition-colors hover:bg-gray-100" onchange="applyFormat('backColor', this.value)" title="Background Color">
                                    <button onclick="document.getElementById('toolbarBgColor').click()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Background Color">
                                        <span class="material-symbols-outlined text-lg">format_color_fill</span>
                                    </button>
                                </div>
                                
                                <!-- Alignment -->
                                <div class="flex gap-1 border-l border-border-light pl-2">
                                    <button onclick="applyFormat('justifyLeft')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Align Left">
                                        <span class="material-symbols-outlined text-lg">format_align_left</span>
                                    </button>
                                    <button onclick="applyFormat('justifyCenter')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Align Center">
                                        <span class="material-symbols-outlined text-lg">format_align_center</span>
                                    </button>
                                    <button onclick="applyFormat('justifyRight')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Align Right">
                                        <span class="material-symbols-outlined text-lg">format_align_right</span>
                                    </button>
                                    <button onclick="applyFormat('justifyFull')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Justify">
                                        <span class="material-symbols-outlined text-lg">format_align_justify</span>
                                    </button>
                                </div>
                                
                                <!-- Lists -->
                                <div class="flex gap-1 border-l border-border-light pl-2">
                                    <button onclick="applyFormat('insertUnorderedList')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Bullet List">
                                        <span class="material-symbols-outlined text-lg">format_list_bulleted</span>
                                    </button>
                                    <button onclick="applyFormat('insertOrderedList')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Numbered List">
                                        <span class="material-symbols-outlined text-lg">format_list_numbered</span>
                                    </button>
                                </div>
                                
                                <!-- Indent -->
                                <div class="flex gap-1 border-l border-border-light pl-2">
                                    <button onclick="applyFormat('outdent')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Decrease Indent">
                                        <span class="material-symbols-outlined text-lg">format_indent_decrease</span>
                                    </button>
                                    <button onclick="applyFormat('indent')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Increase Indent">
                                        <span class="material-symbols-outlined text-lg">format_indent_increase</span>
                                    </button>
                                </div>
                                
                                <!-- Insert -->
                                <div class="flex gap-1 border-l border-border-light pl-2">
                                    <button onclick="insertImage()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Insert Image">
                                        <span class="material-symbols-outlined text-lg">image</span>
                                    </button>
                                    <button onclick="insertLink()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Insert Link">
                                        <span class="material-symbols-outlined text-lg">link</span>
                                    </button>
                                    <button onclick="insertHorizontalRule()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Insert Horizontal Line">
                                        <span class="material-symbols-outlined text-lg">horizontal_rule</span>
                                    </button>
                                </div>
                                
                                <!-- Canvas Controls -->
                                <div class="flex gap-1 border-l border-border-light pl-2 items-center">
                                    <span class="text-xs text-text-muted px-1">Canvas:</span>
                                    <input type="color" id="canvasBgColor" value="#ffffff" class="w-9 h-9 border border-border-light rounded-md cursor-pointer transition-colors hover:bg-gray-100" onchange="changeCanvasBackground(this.value)" title="Background Color">
                                    <select id="canvasSize" class="toolbox-btn px-2 py-2 border border-border-light rounded-md text-sm text-text-default hover:bg-gray-100 transition-colors" onchange="changeCanvasSize(this.value)">
                                        <option value="A4">A4</option>
                                        <option value="A3">A3</option>
                                        <option value="A2">A2</option>
                                        <option value="Letter">Letter</option>
                                        <option value="Custom" selected>Custom</option>
                                    </select>
                                    <button onclick="showCanvasSettings()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Canvas Settings">
                                        <span class="material-symbols-outlined text-lg">settings</span>
                                    </button>
                                    <button onclick="toggleRuler()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Toggle Ruler" id="rulerToggleBtn">
                                        <span class="material-symbols-outlined text-lg">straighten</span>
                                    </button>
                                    <button onclick="toggleGrid()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Toggle Grid" id="gridToggleBtn">
                                        <span class="material-symbols-outlined text-lg">grid_on</span>
                                    </button>
                                    <button onclick="zoomIn()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Zoom In">
                                        <span class="material-symbols-outlined text-lg">zoom_in</span>
                                    </button>
                                    <button onclick="zoomOut()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Zoom Out">
                                        <span class="material-symbols-outlined text-lg">zoom_out</span>
                                    </button>
                                    <span id="zoomLevel" class="text-xs text-text-muted px-2">100%</span>
                                </div>
                            </div>
                    </div>
                </div>
                    
                    <!-- Canvas Container with Ruler -->
                    <div class="flex-1 overflow-auto relative" id="canvasContainer" style="position: relative;">
                        <!-- Ruler Container (fixed position) -->
                        <div id="rulerContainer" class="hidden fixed z-30 bg-gray-50 border-b border-r border-gray-300" style="height: 30px; top: 0; left: 0; right: 0;">
                            <!-- Horizontal Ruler -->
                            <div id="horizontalRuler" class="relative w-full h-full" style="background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);">
                                <!-- Ruler marks will be added by JavaScript -->
                            </div>
                        </div>
                        <!-- Vertical Ruler (fixed position) -->
                        <div id="verticalRuler" class="hidden fixed z-30 bg-gray-50 border-b border-r border-gray-300" style="width: 30px; top: 0; left: 0; background: linear-gradient(to right, #f8f9fa 0%, #e9ecef 100%);">
                            <!-- Ruler marks will be added by JavaScript -->
                        </div>
                        <!-- Canvas -->
                        <div id="designCanvas" class="bg-white relative" contenteditable="false" tabindex="0" style="position: relative; outline: none; margin-left: 30px; margin-top: 30px; width: 794px; height: 1123px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                            <!-- Selection Rectangle (hidden by default) -->
                            <div id="selectionRectangle" class="hidden absolute border-2 border-blue-500 bg-blue-200 bg-opacity-20 pointer-events-none z-40" style="display: none;"></div>
                            <!-- Snap Guides (hidden by default) -->
                            <div id="snapGuideHorizontal" class="hidden absolute bg-blue-500 pointer-events-none z-50" style="height: 2px; display: none; box-shadow: 0 0 3px rgba(59, 130, 246, 0.8);"></div>
                            <div id="snapGuideVertical" class="hidden absolute bg-blue-500 pointer-events-none z-50" style="width: 2px; display: none; box-shadow: 0 0 3px rgba(59, 130, 246, 0.8);"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Toolbox Panel (Right) -->
                <div id="toolboxPanel" class="w-16 bg-surface-light border-l border-border-light overflow-hidden flex-shrink-0 flex flex-col transition-all duration-300">
                    <div class="p-2 border-b border-border-light flex items-center justify-between">
                        <button id="toolboxToggle" onclick="toggleToolbox()" class="p-1 hover:bg-gray-100 rounded transition-colors" title="Genişlet">
                            <span class="material-symbols-outlined text-lg text-text-default">chevron_right</span>
                        </button>
                        <div id="toolboxHeader" class="hidden flex-1 ml-2">
                            <h3 class="text-sm font-semibold text-text-default">Chart Tools</h3>
                            <p class="text-xs text-text-muted">Drag or click</p>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto">
                        <div class="p-2 space-y-2" id="chartToolbox">
                            <!-- Chart tools will be added here by JavaScript -->
                            <div id="toolbox-loading" class="text-xs text-gray-500 p-2">Loading tools...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Saved Canvas Section -->
            <div id="design-saved-section" class="flex-1 flex flex-col overflow-hidden hidden">
                <!-- Project Selector (Top) -->
                <div class="w-full bg-surface-light border-b border-border-light p-3 z-40">
                    <div class="flex items-center gap-2 px-4">
                        <label class="text-sm font-semibold text-text-default">Select Project:</label>
                        <select id="savedCanvasProjectSelect" onchange="loadProjectToCanvas(this.value)" class="px-3 py-2 border border-border-light rounded-md text-sm focus:ring-primary-brand focus:border-primary-brand flex-1 max-w-md">
                            <option value="">-- Select a project --</option>
                        </select>
                    </div>
                </div>
                
                <!-- Design Canvas Content -->
                <div class="flex-1 flex overflow-hidden">
                    <!-- Left Panel Container -->
                    <div class="w-48 bg-surface-light border-r border-border-light flex-shrink-0 flex flex-col" style="overflow: visible;">
                        <!-- Pages Panel (Top - Smaller) -->
                        <div id="pagesPanelSaved" class="overflow-y-auto flex flex-col" style="height: 35%; min-height: 150px;">
                            <div class="p-3 border-b border-border-light">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-sm font-semibold text-text-default">Pages</h3>
                                    <button onclick="addNewPageSaved()" class="p-1 hover:bg-gray-100 rounded transition-colors" title="Add Page">
                                        <span class="material-symbols-outlined text-lg text-text-muted">add</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1 overflow-y-auto p-2">
                                <div id="pagesListSaved" class="space-y-1">
                                    <!-- Pages will be added here by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dataset Panel (Bottom - Larger, closer to Pages) -->
                        <div id="datasetPanelSaved" class="flex-1 overflow-visible flex flex-col border-t border-border-light" style="height: 65%; min-height: 300px;">
                            <div class="p-3 border-b border-border-light">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-sm font-semibold text-text-default">Dataset</h3>
                                    <button onclick="openDatasetModal()" class="p-1 hover:bg-gray-100 rounded transition-colors" title="Add Dataset">
                                        <span class="material-symbols-outlined text-lg text-text-muted">add</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1 overflow-y-auto overflow-x-visible p-2" style="overflow-x: visible;">
                                <div id="datasetListSaved" class="space-y-2 relative">
                                    <!-- Datasets will be added here by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Canvas Area (Right) -->
                    <div class="flex-1 flex flex-col overflow-hidden bg-background-light relative">
                        <!-- Word-like Toolbar -->
                        <div class="bg-surface-light border-b border-border-light p-2">
                            <div class="flex flex-wrap items-center gap-2">
                                <!-- Left Side - Font Controls & Formatting -->
                                <div class="flex items-center gap-1 flex-1">
                                    <!-- Font Family -->
                                    <div class="flex flex-col gap-2">
                                        <select id="toolbarFontSaved" class="toolbox-btn px-2 py-2 border border-border-light rounded-md text-sm text-text-default hover:bg-gray-100 transition-colors" onchange="applyFormat('fontName', this.value)">
                                            <option value="Arial">Arial</option>
                                            <option value="Times New Roman">Times New Roman</option>
                                            <option value="Courier New">Courier New</option>
                                            <option value="Georgia">Georgia</option>
                                            <option value="Verdana">Verdana</option>
                                            <option value="Comic Sans MS">Comic Sans MS</option>
                                        </select>
                                        <!-- Save Project & Export Buttons -->
                                        <div class="flex gap-1">
                                            <button onclick="saveProject()" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded-md flex items-center gap-1 text-xs shadow-md" title="Save Project">
                                                <span class="material-symbols-outlined text-sm">save</span>
                                                <span>Save</span>
                                            </button>
                                            <button onclick="openExportSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded-md flex items-center gap-1 text-xs shadow-md" title="Export">
                                                <span class="material-symbols-outlined text-sm">download</span>
                                                <span>Export</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Font Size -->
                                    <select id="toolbarFontSizeSaved" class="toolbox-btn px-2 py-2 border border-border-light rounded-md text-sm text-text-default hover:bg-gray-100 transition-colors" onchange="applyFormat('fontSize', this.value)">
                                        <option value="1">8pt</option>
                                        <option value="2">10pt</option>
                                        <option value="3" selected>12pt</option>
                                        <option value="4">14pt</option>
                                        <option value="5">18pt</option>
                                        <option value="6">24pt</option>
                                        <option value="7">36pt</option>
                                    </select>
                                    
                                    <!-- Text Formatting -->
                                    <div class="flex gap-1 border-l border-border-light pl-2">
                                        <button onclick="applyFormat('bold')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Bold">
                                            <span class="material-symbols-outlined text-lg">format_bold</span>
                                        </button>
                                        <button onclick="applyFormat('italic')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Italic">
                                            <span class="material-symbols-outlined text-lg">format_italic</span>
                                        </button>
                                        <button onclick="applyFormat('underline')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Underline">
                                            <span class="material-symbols-outlined text-lg">format_underlined</span>
                                        </button>
                                        <button onclick="applyFormat('strikethrough')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Strikethrough">
                                            <span class="material-symbols-outlined text-lg">strikethrough_s</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Text Color -->
                                    <div class="flex gap-1 border-l border-border-light pl-2">
                                        <input type="color" id="toolbarTextColorSaved" value="#000000" class="w-9 h-9 border border-border-light rounded-md cursor-pointer transition-colors hover:bg-gray-100" onchange="applyFormat('foreColor', this.value)" title="Text Color">
                                        <button onclick="document.getElementById('toolbarTextColorSaved').click()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Text Color">
                                            <span class="material-symbols-outlined text-lg">format_color_text</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Background Color -->
                                    <div class="flex gap-1 border-l border-border-light pl-2">
                                        <input type="color" id="toolbarBgColorSaved" value="#ffffff" class="w-9 h-9 border border-border-light rounded-md cursor-pointer transition-colors hover:bg-gray-100" onchange="applyFormat('backColor', this.value)" title="Background Color">
                                        <button onclick="document.getElementById('toolbarBgColorSaved').click()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Background Color">
                                            <span class="material-symbols-outlined text-lg">format_color_fill</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Alignment -->
                                    <div class="flex gap-1 border-l border-border-light pl-2">
                                        <button onclick="applyFormat('justifyLeft')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Align Left">
                                            <span class="material-symbols-outlined text-lg">format_align_left</span>
                                        </button>
                                        <button onclick="applyFormat('justifyCenter')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Align Center">
                                            <span class="material-symbols-outlined text-lg">format_align_center</span>
                                        </button>
                                        <button onclick="applyFormat('justifyRight')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Align Right">
                                            <span class="material-symbols-outlined text-lg">format_align_right</span>
                                        </button>
                                        <button onclick="applyFormat('justifyFull')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Justify">
                                            <span class="material-symbols-outlined text-lg">format_align_justify</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Lists -->
                                    <div class="flex gap-1 border-l border-border-light pl-2">
                                        <button onclick="applyFormat('insertUnorderedList')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Bullet List">
                                            <span class="material-symbols-outlined text-lg">format_list_bulleted</span>
                                        </button>
                                        <button onclick="applyFormat('insertOrderedList')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Numbered List">
                                            <span class="material-symbols-outlined text-lg">format_list_numbered</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Indent -->
                                    <div class="flex gap-1 border-l border-border-light pl-2">
                                        <button onclick="applyFormat('outdent')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Decrease Indent">
                                            <span class="material-symbols-outlined text-lg">format_indent_decrease</span>
                                        </button>
                                        <button onclick="applyFormat('indent')" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Increase Indent">
                                            <span class="material-symbols-outlined text-lg">format_indent_increase</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Insert -->
                                    <div class="flex gap-1 border-l border-border-light pl-2">
                                        <button onclick="insertImage()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Insert Image">
                                            <span class="material-symbols-outlined text-lg">image</span>
                                        </button>
                                        <button onclick="insertLink()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Insert Link">
                                            <span class="material-symbols-outlined text-lg">link</span>
                                        </button>
                                        <button onclick="insertHorizontalRule()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Insert Horizontal Line">
                                            <span class="material-symbols-outlined text-lg">horizontal_rule</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Canvas Controls -->
                                    <div class="flex gap-1 border-l border-border-light pl-2 items-center">
                                        <span class="text-xs text-text-muted px-1">Canvas:</span>
                                        <input type="color" id="canvasBgColorSaved" value="#ffffff" class="w-9 h-9 border border-border-light rounded-md cursor-pointer transition-colors hover:bg-gray-100" onchange="changeCanvasBackground(this.value)" title="Background Color">
                                        <select id="canvasSizeSaved" class="toolbox-btn px-2 py-2 border border-border-light rounded-md text-sm text-text-default hover:bg-gray-100 transition-colors" onchange="changeCanvasSize(this.value)">
                                            <option value="A4">A4</option>
                                            <option value="A3">A3</option>
                                            <option value="A2">A2</option>
                                            <option value="Letter">Letter</option>
                                            <option value="Custom" selected>Custom</option>
                                        </select>
                                        <button onclick="showCanvasSettings()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Canvas Settings">
                                            <span class="material-symbols-outlined text-lg">settings</span>
                                        </button>
                                        <button onclick="toggleRuler()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Toggle Ruler" id="rulerToggleBtnSaved">
                                            <span class="material-symbols-outlined text-lg">straighten</span>
                                        </button>
                                        <button onclick="toggleGrid()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Toggle Grid" id="gridToggleBtnSaved">
                                            <span class="material-symbols-outlined text-lg">grid_on</span>
                                        </button>
                                        <button onclick="zoomIn()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Zoom In">
                                            <span class="material-symbols-outlined text-lg">zoom_in</span>
                                        </button>
                                        <button onclick="zoomOut()" class="toolbox-btn flex items-center justify-center px-2 py-2 text-sm text-text-default rounded-md transition-colors hover:bg-gray-100" title="Zoom Out">
                                            <span class="material-symbols-outlined text-lg">zoom_out</span>
                                        </button>
                                        <span id="zoomLevelSaved" class="text-xs text-text-muted px-2">100%</span>
                                    </div>
                                </div>
                                
                                    <!-- Right Side - Symbols & Shapes Panel -->
                                    <div class="flex items-center gap-2 border-l border-border-light pl-2 ml-auto w-full">
                                        <div class="symbols-shapes-toolbar-panel bg-transparent relative w-full">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="text-xs font-semibold text-text-default px-1">Symbols & Shapes</span>
                                                <div class="flex gap-1">
                                                    <button onclick="expandSymbolsShapesPanel('Saved')" class="toolbox-btn flex items-center justify-center px-1.5 py-1 text-xs text-text-default rounded transition-colors hover:bg-gray-100" title="Expand" id="expandSymbolsBtnSaved">
                                                        <span class="material-symbols-outlined text-sm">add</span>
                                                    </button>
                                                    <button onclick="collapseSymbolsShapesPanel('Saved')" class="toolbox-btn flex items-center justify-center px-1.5 py-1 text-xs text-text-default rounded transition-colors hover:bg-gray-100 hidden" title="Collapse" id="collapseSymbolsBtnSaved">
                                                        <span class="material-symbols-outlined text-sm">remove</span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="toolbarSymbolsShapesListSaved" class="grid grid-cols-10 gap-1 overflow-y-auto overflow-x-hidden p-0" style="grid-auto-rows: minmax(60px, auto); max-height: 60px; transition: max-height 0.3s ease;">
                                                <!-- Symbols and shapes will be rendered here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        <!-- Canvas -->
                        <div id="designCanvasSaved" class="flex-1 overflow-hidden bg-white p-8 relative" contenteditable="false" tabindex="0">
                        </div>
                    </div>
                    
                    <!-- Toolbox Panel (Right) -->
                    <div id="toolboxPanelSaved" class="w-16 bg-surface-light border-l border-border-light overflow-hidden flex-shrink-0 flex flex-col transition-all duration-300">
                        <div class="p-2 border-b border-border-light flex items-center justify-between">
                            <button id="toolboxToggleSaved" onclick="toggleToolboxSaved()" class="p-1 hover:bg-gray-100 rounded transition-colors" title="Genişlet">
                                <span class="material-symbols-outlined text-lg text-text-default">chevron_right</span>
                            </button>
                            <div id="toolboxHeaderSaved" class="hidden flex-1 ml-2">
                                <h3 class="text-sm font-semibold text-text-default">Chart Tools</h3>
                                <p class="text-xs text-text-muted">Drag or click</p>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto">
                            <div class="p-2 space-y-2" id="chartToolboxSaved">
                                <!-- Chart tools will be added here by JavaScript -->
                                <div id="toolbox-loading-saved" class="text-xs text-gray-500 p-2">Loading tools...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section (placeholder) -->
            <div id="dashboard-section" class="flex-1 flex flex-col overflow-hidden hidden">
                <div class="flex-1 flex items-center justify-center bg-background-light">
                    <p class="text-text-muted">Dashboard section - Coming soon</p>
                </div>
            </div>

            <!-- Data Stream Section -->
            <div id="data-stream-section" class="flex-1 flex flex-col overflow-hidden hidden">
                <!-- Header with Refresh Interval -->
                <div class="bg-surface-light border-b border-border-light px-6 py-4 flex items-center justify-between">
                    <div>
                    </div>
                    <div class="flex items-center gap-3">
                        <label class="text-sm text-text-muted">Refresh Interval:</label>
                        <select id="refreshInterval" class="px-3 py-2 border border-border-light rounded-md text-sm focus:ring-primary-brand focus:border-primary-brand">
                            <option value="1">Every Minute</option>
                            <option value="60" selected>Hourly</option>
                            <option value="360">Every 6 Hours</option>
                            <option value="1440">Daily</option>
                        </select>
                        <button onclick="startDataStream()" id="startStreamBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm">play_arrow</span>
                            Start Stream
                        </button>
                        <button onclick="stopDataStream()" id="stopStreamBtn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md text-sm flex items-center gap-2 hidden">
                            <span class="material-symbols-outlined text-sm">stop</span>
                            Stop Stream
                        </button>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div class="flex-1 flex overflow-hidden">
                    <!-- Left Panel - Projects List -->
                    <div class="w-64 border-r border-border-light bg-surface-light overflow-y-auto">
                        <div class="p-4 border-b border-border-light">
                            <h3 class="text-lg font-semibold text-text-default mb-2">Saved Projects</h3>
                            <div class="relative">
                                <input type="text" id="projectSearch" placeholder="Search projects..." class="w-full px-3 py-2 border border-border-light rounded-md text-sm focus:ring-primary-brand focus:border-primary-brand">
                                <span class="material-symbols-outlined absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted text-sm">search</span>
                            </div>
                        </div>
                        <div id="projectsList" class="p-2">
                            <!-- Projects will be listed here -->
                        </div>
                    </div>
                    
                    <!-- Right Panel - Project View (Read-only) -->
                    <div class="flex-1 flex flex-col overflow-hidden bg-background-light">
                        <div id="projectViewContainer" class="flex-1 overflow-hidden p-6 relative" style="height: calc(100vh - 200px);">
                            <div id="noProjectSelected" class="flex flex-col items-center justify-center h-full text-center">
                                <span class="material-symbols-outlined text-6xl text-text-muted mb-4">dashboard</span>
                                <p class="text-text-muted text-lg">Select a project to view</p>
                                <p class="text-text-muted text-sm mt-2">Choose a project from the left panel to see its live data stream</p>
                            </div>
                            <!-- Project canvas will be rendered here (read-only) -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Sources Section (placeholder) -->
            <div id="data-sources-section" class="flex-1 flex flex-col overflow-hidden hidden">
                <div class="flex-1 flex items-center justify-center bg-background-light">
                    <p class="text-text-muted">Data Sources section - Coming soon</p>
                </div>
            </div>

            <!-- Settings Section (placeholder) -->
            <div id="settings-section" class="flex-1 flex flex-col overflow-hidden hidden">
                <div class="flex-1 flex items-center justify-center bg-background-light">
                    <p class="text-text-muted">Settings section - Coming soon</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Custom Dialog Modal -->
    <div id="customDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] hidden">
        <div class="bg-surface-light rounded-lg shadow-lg w-96 max-w-full mx-4">
            <div class="p-6 border-b border-border-light flex justify-between items-center">
                <h3 id="dialogTitle" class="text-lg font-semibold text-text-default">Confirm</h3>
                <button id="dialogCloseBtn" class="text-text-muted hover:text-text-default">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-6">
                <p id="dialogMessage" class="text-text-default">Are you sure?</p>
            </div>
            <div class="p-6 border-t border-border-light flex justify-end gap-2">
                <button id="dialogCancelBtn" class="px-4 py-2 border border-border-light rounded-md text-sm hover:bg-gray-100">Cancel</button>
                <button id="dialogConfirmBtn" class="px-4 py-2 bg-primary-brand hover:bg-primary-brand-hover text-white rounded-md text-sm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Custom Alert/Notification -->
    <div id="customAlert" class="fixed top-4 right-4 z-50 hidden">
        <div id="alertContainer" class="bg-surface-light rounded-lg shadow-lg p-4 flex items-center gap-3 min-w-80 border-l-4">
            <div id="alertIcon" class="text-2xl">✓</div>
            <div id="alertMessage" class="flex-1 text-sm font-medium text-text-default">Success!</div>
            <button onclick="closeAlert()" class="text-text-muted hover:text-text-default">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
    </div>

    <!-- Custom Prompt Dialog for Page Rename -->
    <div id="customPromptDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] hidden">
        <div class="bg-surface-light rounded-lg shadow-lg w-96 max-w-full mx-4">
            <div class="p-6 border-b border-border-light flex justify-between items-center">
                <h3 id="promptDialogTitle" class="text-lg font-semibold text-text-default">Rename Page</h3>
                <button id="promptDialogCloseBtn" onclick="if(typeof closePromptDialog === 'function') closePromptDialog();" class="text-text-muted hover:text-text-default">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-6">
                <label class="text-sm text-text-muted mb-2 block">Page Name:</label>
                <input type="text" id="promptDialogInput" class="w-full px-3 py-2 border border-border-light rounded-md text-sm focus:ring-primary-brand focus:border-primary-brand" placeholder="Enter page name">
            </div>
            <div class="p-6 border-t border-border-light flex justify-end gap-2">
                <button id="promptDialogCancelBtn" class="px-4 py-2 border border-border-light rounded-md text-sm hover:bg-gray-100">Cancel</button>
                <button id="promptDialogConfirmBtn" class="px-4 py-2 bg-primary-brand hover:bg-primary-brand-hover text-white rounded-md text-sm">OK</button>
            </div>
        </div>
    </div>

    <!-- Dataset Modal -->
    <div id="datasetModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl w-[90vw] max-w-4xl h-[85vh] flex flex-col">
            <!-- Modal Header -->
            <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-800">Add Dataset</h2>
                <button onclick="closeDatasetModal()" class="text-gray-500 hover:text-gray-700">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <!-- Modal Content -->
            <div class="flex-1 flex flex-col overflow-hidden p-4">
                <!-- Linked Service Selection -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Linked Service:</label>
                    <select id="datasetLinkedService" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-primary-brand focus:border-primary-brand" onchange="onDatasetServiceChange()">
                        <option value="">-- Select a service --</option>
                    </select>
                </div>
                
                <!-- DB Query Section (shown when DB service selected) -->
                <div id="datasetQuerySection" class="hidden mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-700">SQL Query:</label>
                        <button onclick="generateSQLWithAI()" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-xs flex items-center gap-1">
                            <span class="material-symbols-outlined text-sm">smart_toy</span>
                            AI Help
                        </button>
                    </div>
                    <textarea id="datasetQuery" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm font-mono" rows="8" placeholder="SELECT * FROM table_name"></textarea>
                    <p class="text-xs text-gray-500 mt-1">Write your SQL query or use AI to generate it</p>
                </div>
                
                <!-- AI Help Modal (for SQL generation) -->
                <div id="aiSQLModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center">
                    <div class="bg-white rounded-lg shadow-xl w-[90vw] max-w-2xl">
                        <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">AI SQL Generator</h3>
                            <button onclick="closeAISQLModal()" class="text-gray-500 hover:text-gray-700">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                        <div class="p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Describe what you want to query:</label>
                            <textarea id="aiSQLPrompt" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" rows="4" placeholder="e.g., Get all customers from New York with orders greater than $1000"></textarea>
                            <div class="flex justify-end gap-2 mt-4">
                                <button onclick="closeAISQLModal()" class="px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-100">Cancel</button>
                                <button onclick="generateSQL()" class="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">Generate SQL</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="p-4 border-t border-gray-200 flex justify-end gap-2">
                <button onclick="closeDatasetModal()" class="px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-100">Cancel</button>
                <button onclick="addDataset()" class="px-4 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700">Add Dataset</button>
            </div>
        </div>
    </div>

    <!-- Export Settings Modal -->
    <div id="exportSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl w-[90vw] max-w-6xl h-[90vh] flex flex-col">
            <!-- Modal Header -->
            <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                <h2 id="exportModalTitle" class="text-xl font-bold text-gray-800">Export Settings</h2>
                <button onclick="closeExportSettings()" class="text-gray-500 hover:text-gray-700">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <!-- Modal Content -->
            <div class="flex-1 flex overflow-hidden">
                <!-- Left Panel - Settings -->
                <div class="w-1/3 border-r border-gray-200 overflow-y-auto p-4">
                    <div class="space-y-4">
                        <!-- Export Type Tabs -->
                        <div class="flex gap-2 border-b border-gray-200">
                            <button onclick="switchExportTab('pdf')" class="export-tab-btn px-4 py-2 text-sm font-medium border-b-2 border-red-600 text-red-600" data-export-tab="pdf">PDF</button>
                            <button onclick="switchExportTab('powerpoint')" class="export-tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-600" data-export-tab="powerpoint">PowerPoint</button>
                        </div>
                        
                        <!-- PDF Settings -->
                        <div id="pdfSettings" class="export-settings-content">
                            <h3 class="text-sm font-semibold mb-3">PDF Settings</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-xs text-gray-600 mb-1 block">Page Size</label>
                                    <select id="pdfPageSize" class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                        <option value="A4">A4 (210×297mm)</option>
                                        <option value="A3">A3 (297×420mm)</option>
                                        <option value="Letter">Letter (8.5×11in)</option>
                                        <option value="Legal">Legal (8.5×14in)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 mb-1 block">Orientation</label>
                                    <select id="pdfOrientation" class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                        <option value="portrait">Portrait</option>
                                        <option value="landscape">Landscape</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 mb-1 block">Margin (mm)</label>
                                    <input type="number" id="pdfMargin" value="10" class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                </div>
                            </div>
                        </div>
                        
                        <!-- PowerPoint Settings -->
                        <div id="powerpointSettings" class="export-settings-content hidden">
                            <h3 class="text-sm font-semibold mb-3">PowerPoint Settings</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-xs text-gray-600 mb-1 block">Slide Size</label>
                                    <select id="pptSlideSize" class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                        <option value="16:9">16:9 (Widescreen)</option>
                                        <option value="4:3">4:3 (Standard)</option>
                                        <option value="A4">A4</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Layout Options -->
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-semibold">Page Layout</h3>
                                <button onclick="autoLayout()" class="text-xs text-blue-600 hover:text-blue-800">Auto Layout</button>
                            </div>
                            <div id="layoutPreview" class="space-y-2 max-h-96 overflow-y-auto">
                                <!-- Layout items will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Panel - Preview -->
                <div class="flex-1 overflow-y-auto p-4 bg-gray-50">
                    <h3 class="text-sm font-semibold mb-3">Preview</h3>
                    <div id="exportPreview" class="bg-white border border-gray-200 rounded p-4 min-h-[500px]">
                        <!-- Preview will be rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="p-4 border-t border-gray-200 flex justify-end gap-2">
                <button onclick="closeExportSettings()" class="px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-100">Cancel</button>
                <button onclick="generateExport()" id="exportBtn" class="px-4 py-2 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                    Export PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Plotly.js for interactive charts -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- SheetJS for Excel import/export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas for converting HTML to canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- pptxgenjs for PowerPoint export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pptxgenjs/3.12.0/pptxgen.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/design.js') }}"></script>
    <script src="{{ url_for('static', filename='js/connection-modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/export.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart-settings.js') }}"></script>
    <script src="{{ url_for('static', filename='js/data-stream.js') }}"></script>
    <script>
        // Initialize theme immediately when scripts load
        if (typeof initTheme === 'function') {
            initTheme();
        } else {
            // Fallback if function not loaded yet
            document.addEventListener('DOMContentLoaded', function() {
                if (typeof initTheme === 'function') {
                    initTheme();
                }
            });
        }
    </script>
    
    <!-- Force render toolbox when design section is shown -->
    <script>
        (function() {
            let renderAttempts = 0;
            const maxAttempts = 50;
            
            function forceRenderToolbox() {
                renderAttempts++;
                console.log(`[Toolbox Render] Attempt ${renderAttempts}/${maxAttempts}`);
                
                const toolbox = document.getElementById('chartToolbox');
                const designSection = document.getElementById('design-section');
                
                if (!toolbox) {
                    console.log('[Toolbox Render] Toolbox element not found');
                    if (renderAttempts < maxAttempts) {
                        setTimeout(forceRenderToolbox, 200);
                    }
                    return;
                }
                
                // Check if design section is visible
                const isDesignVisible = designSection && !designSection.classList.contains('hidden');
                const hasLoading = toolbox.querySelector('#toolbox-loading') || toolbox.innerHTML.includes('Loading tools');
                const hasButtons = toolbox.querySelectorAll('button').length > 0;
                
                console.log('[Toolbox Render] Toolbox found');
                console.log('[Toolbox Render] Design visible:', isDesignVisible);
                console.log('[Toolbox Render] Has loading:', hasLoading);
                console.log('[Toolbox Render] Has buttons:', hasButtons);
                console.log('[Toolbox Render] renderChartToolbox:', typeof renderChartToolbox);
                console.log('[Toolbox Render] chartTypes:', typeof chartTypes);
                
                // If design section is visible and toolbox is empty/loading, render it
                if (isDesignVisible && (hasLoading || !hasButtons)) {
                    if (typeof renderChartToolbox === 'function') {
                        console.log('[Toolbox Render] Calling renderChartToolbox...');
                        try {
                            renderChartToolbox();
                            console.log('[Toolbox Render] renderChartToolbox called successfully');
                        } catch (e) {
                            console.error('[Toolbox Render] Error calling renderChartToolbox:', e);
                            if (renderAttempts < maxAttempts) {
                                setTimeout(forceRenderToolbox, 300);
                            }
                        }
                    } else {
                        console.warn('[Toolbox Render] renderChartToolbox function not available yet');
                        if (renderAttempts < maxAttempts) {
                            setTimeout(forceRenderToolbox, 200);
                        }
                    }
                } else if (!isDesignVisible && renderAttempts < maxAttempts) {
                    // Keep checking if design section becomes visible
                    setTimeout(forceRenderToolbox, 500);
                }
            }
            
            // Watch for design section visibility changes
            function setupWatcher() {
                const designSection = document.getElementById('design-section');
                if (designSection) {
                    const observer = new MutationObserver(() => {
                        const isVisible = !designSection.classList.contains('hidden');
                        if (isVisible) {
                            console.log('[Toolbox Render] Design section became visible, forcing render...');
                            setTimeout(forceRenderToolbox, 100);
                        }
                    });
                    observer.observe(designSection, { attributes: true, attributeFilter: ['class'] });
                    console.log('[Toolbox Render] Watcher set up');
                } else {
                    setTimeout(setupWatcher, 100);
                }
            }
            
            // Start when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    console.log('[Toolbox Render] DOM loaded, starting...');
                    setTimeout(forceRenderToolbox, 500);
                    setupWatcher();
                });
            } else {
                console.log('[Toolbox Render] DOM already loaded, starting...');
                setTimeout(forceRenderToolbox, 500);
                setupWatcher();
            }
            
            // Also check periodically as fallback
            setInterval(() => {
                const toolbox = document.getElementById('chartToolbox');
                const designSection = document.getElementById('design-section');
                if (toolbox && designSection) {
                    const isVisible = !designSection.classList.contains('hidden');
                    const hasLoading = toolbox.querySelector('#toolbox-loading') || toolbox.innerHTML.includes('Loading tools');
                    const hasButtons = toolbox.querySelectorAll('button').length > 0;
                    
                    if (isVisible && hasLoading && !hasButtons && typeof renderChartToolbox === 'function') {
                        console.log('[Toolbox Render] Fallback: Rendering toolbox...');
                        renderChartToolbox();
                    }
                }
            }, 2000);
        })();
    </script>
</body>
</html>
